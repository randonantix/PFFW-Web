<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PF Firewall: RuleSet Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PF Firewall<span id="projectnumber">&#160;7.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('classModel_1_1RuleSet.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Data Fields</a>  </div>
  <div class="headertitle"><div class="title">RuleSet Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Loads, validates, parses, and generates a list of rules.  
 <a href="classModel_1_1RuleSet.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ab0b389ad9ebc166cb794517ae2d32f77"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classModel_1_1RuleSet.html#ab0b389ad9ebc166cb794517ae2d32f77">load</a> ($rulesArray, $force=FALSE)</td></tr>
<tr class="memdesc:ab0b389ad9ebc166cb794517ae2d32f77"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loads the rule definitions given in an array.  <br /></td></tr>
<tr class="separator:ab0b389ad9ebc166cb794517ae2d32f77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b2ce2ed8ce3b208ef9aa0bd32a06746"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classModel_1_1RuleSet.html#a7b2ce2ed8ce3b208ef9aa0bd32a06746">deleteRules</a> ()</td></tr>
<tr class="memdesc:a7b2ce2ed8ce3b208ef9aa0bd32a06746"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deletes all the rules in the ruleset.  <br /></td></tr>
<tr class="separator:a7b2ce2ed8ce3b208ef9aa0bd32a06746"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a993caf27d61ba671b700b966eb23e926"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classModel_1_1RuleSet.html#a993caf27d61ba671b700b966eb23e926">parse</a> ($text, $force=FALSE)</td></tr>
<tr class="memdesc:a993caf27d61ba671b700b966eb23e926"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parses the given rule string.  <br /></td></tr>
<tr class="separator:a993caf27d61ba671b700b966eb23e926"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6177d48190953277c146592478f02e24"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classModel_1_1RuleSet.html#a6177d48190953277c146592478f02e24">validate</a> ($force=FALSE)</td></tr>
<tr class="memdesc:a6177d48190953277c146592478f02e24"><td class="mdescLeft">&#160;</td><td class="mdescRight">Validates the ruleset.  <br /></td></tr>
<tr class="separator:a6177d48190953277c146592478f02e24"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b90753ebc701d41dbd2e3abb2e64cdb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classModel_1_1RuleSet.html#a5b90753ebc701d41dbd2e3abb2e64cdb">parseInlineRules</a> ($ruleLines, &amp;$str, &amp;$index, $force=FALSE)</td></tr>
<tr class="memdesc:a5b90753ebc701d41dbd2e3abb2e64cdb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Collects inline anchor rules spanning multiple lines.  <br /></td></tr>
<tr class="separator:a5b90753ebc701d41dbd2e3abb2e64cdb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa828e6f15a288548f7aad058f276ef53"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classModel_1_1RuleSet.html#aa828e6f15a288548f7aad058f276ef53">generate</a> ($printNumbers=FALSE)</td></tr>
<tr class="memdesc:aa828e6f15a288548f7aad058f276ef53"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints the ruleset.  <br /></td></tr>
<tr class="separator:aa828e6f15a288548f7aad058f276ef53"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Data Fields</h2></td></tr>
<tr class="memitem:a811d22ac55b4592f7f2a202529629419"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classModel_1_1RuleSet.html#a811d22ac55b4592f7f2a202529629419">$rules</a> = array()</td></tr>
<tr class="separator:a811d22ac55b4592f7f2a202529629419"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Loads, validates, parses, and generates a list of rules. </p>

<p class="definition">Definition at line <a class="el" href="Model_2lib_2RuleSet_8php_source.html#l00044">44</a> of file <a class="el" href="Model_2lib_2RuleSet_8php_source.html">RuleSet.php</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a7b2ce2ed8ce3b208ef9aa0bd32a06746" name="a7b2ce2ed8ce3b208ef9aa0bd32a06746"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b2ce2ed8ce3b208ef9aa0bd32a06746">&#9670;&#160;</a></span>deleteRules()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">deleteRules </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Deletes all the rules in the ruleset. </p>

<p class="definition">Definition at line <a class="el" href="Model_2lib_2RuleSet_8php_source.html#l00100">100</a> of file <a class="el" href="Model_2lib_2RuleSet_8php_source.html">RuleSet.php</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  101</span>    {</div>
<div class="line"><span class="lineno">  102</span>        $this-&gt;rules= array();</div>
<div class="line"><span class="lineno">  103</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa828e6f15a288548f7aad058f276ef53" name="aa828e6f15a288548f7aad058f276ef53"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa828e6f15a288548f7aad058f276ef53">&#9670;&#160;</a></span>generate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">generate </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$printNumbers</em> = <code>FALSE</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prints the ruleset. </p>
<p>We iterate over all the rule objects and ask them to return string representations of themselves. We combine these strings and print on the Display page.</p>
<p>The default on the Display page is to print line numbers in front of each line.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">bool</td><td class="paramname">$printNumbers</td><td>Print line numbers. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string Generated rules. </dd></dl>

<p class="definition">Definition at line <a class="el" href="Model_2lib_2RuleSet_8php_source.html#l00364">364</a> of file <a class="el" href="Model_2lib_2RuleSet_8php_source.html">RuleSet.php</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  365</span>    {</div>
<div class="line"><span class="lineno">  366</span>        $str= <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><span class="lineno">  367</span>        <span class="keywordflow">foreach</span> ($this-&gt;rules as $rule) {</div>
<div class="line"><span class="lineno">  368</span>            $str.= $rule-&gt;generate();</div>
<div class="line"><span class="lineno">  369</span>        }</div>
<div class="line"><span class="lineno">  370</span>        </div>
<div class="line"><span class="lineno">  371</span>        <span class="comment">// Do not merge this loop with the generate loop above, because there are rules which produce</span></div>
<div class="line"><span class="lineno">  372</span>        <span class="comment">// multiline string representations, such as comments and anchors with inline rules.</span></div>
<div class="line"><span class="lineno">  373</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="conf_8write_8php.html#a4a14a670e7bcd969896df554e17f53c2">$printNumbers</a>) {</div>
<div class="line"><span class="lineno">  374</span>            $ruleNumber= 0;</div>
<div class="line"><span class="lineno">  375</span>            $s= <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><span class="lineno">  376</span>            <span class="keywordflow">foreach</span> (explode(<span class="stringliteral">&quot;\n&quot;</span>, $str) as $line) {</div>
<div class="line"><span class="lineno">  377</span>                $s.= sprintf(<span class="stringliteral">&#39;% 4d&#39;</span>, $ruleNumber++) . <span class="stringliteral">&quot;: $line\n&quot;</span>;</div>
<div class="line"><span class="lineno">  378</span>            }</div>
<div class="line"><span class="lineno">  379</span>            $str= $s;</div>
<div class="line"><span class="lineno">  380</span>        }</div>
<div class="line"><span class="lineno">  381</span>        <span class="keywordflow">return</span> $str;</div>
<div class="line"><span class="lineno">  382</span>    }</div>
<div class="ttc" id="aconf_8write_8php_html_a4a14a670e7bcd969896df554e17f53c2"><div class="ttname"><a href="conf_8write_8php.html#a4a14a670e7bcd969896df554e17f53c2">$printNumbers</a></div><div class="ttdeci">$printNumbers</div><div class="ttdef"><b>Definition:</b> <a href="conf_8write_8php_source.html#l00023">conf.write.php:23</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="conf_8write_8php_source.html#l00023">$printNumbers</a>.</p>

</div>
</div>
<a id="ab0b389ad9ebc166cb794517ae2d32f77" name="ab0b389ad9ebc166cb794517ae2d32f77"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0b389ad9ebc166cb794517ae2d32f77">&#9670;&#160;</a></span>load()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">load </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$rulesArray</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$force</em> = <code>FALSE</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Loads the rule definitions given in an array. </p>
<p>The rule definitions in $rulesArray contains the type and NVP elements of the rule. For each item in $rulesArray, we create an empty rule object of type mentioned in the rule definition and call the load method of the rule with the NVP elements.</p>
<p>Rule number is determined by the order of the rule in the given $rulesArray.</p>
<p>If loading produces errors, we can force loading by setting $force to TRUE. The user is allowed to do this on the WUI, so that rule sets with errors can be loaded and fixed using PFRE.</p>
<p>Note that loading does not stop even if $force is set to FALSE, we partially load the current rule with error and continue loading the next rule in the array.</p>
<p>Also, this is where we set the nesting string, which is used in reporting errors in nested anchors in inline rules.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$rulesArray</td><td>List of rule definitions in an array. </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$force</td><td>Used to override validation or other types of errors, hence forces loading of rules. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool Load result. </dd></dl>

<p class="definition">Definition at line <a class="el" href="Model_2lib_2RuleSet_8php_source.html#l00069">69</a> of file <a class="el" href="Model_2lib_2RuleSet_8php_source.html">RuleSet.php</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   70</span>    {</div>
<div class="line"><span class="lineno">   71</span>        global $Nesting;</div>
<div class="line"><span class="lineno">   72</span>        $nestingStr= $Nesting &gt; 0 ? <span class="stringliteral">&quot;Nesting $Nesting, &quot;</span> : <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><span class="lineno">   73</span> </div>
<div class="line"><span class="lineno">   74</span>        $this-&gt;deleteRules();</div>
<div class="line"><span class="lineno">   75</span>    </div>
<div class="line"><span class="lineno">   76</span>        <a class="code hl_variable" href="ctlr_8php.html#a80b96347dc2ad0d4e3748dc87db72731">$retval</a>= TRUE;</div>
<div class="line"><span class="lineno">   77</span>        $ruleNumber= 0;</div>
<div class="line"><span class="lineno">   78</span>        <span class="keywordflow">foreach</span> ($rulesArray as $ruleDef) {</div>
<div class="line"><span class="lineno">   79</span>            $cat= __NAMESPACE__ . <span class="charliteral">&#39;\\&#39;</span> . $ruleDef[<span class="stringliteral">&#39;cat&#39;</span>];</div>
<div class="line"><span class="lineno">   80</span>            $ruleObj= <span class="keyword">new</span> $cat(<span class="stringliteral">&#39;&#39;</span>);</div>
<div class="line"><span class="lineno">   81</span>            <span class="keywordflow">if</span> (!$ruleObj-&gt;load($ruleDef[<span class="stringliteral">&#39;rule&#39;</span>], $ruleNumber, <a class="code hl_variable" href="conf_8write_8php.html#ac60027de12260e75a070f5a7618fd632">$force</a>)) {</div>
<div class="line"><span class="lineno">   82</span>                <span class="keywordflow">if</span> (!<a class="code hl_variable" href="conf_8write_8php.html#ac60027de12260e75a070f5a7618fd632">$force</a>) {</div>
<div class="line"><span class="lineno">   83</span>                    <a class="code hl_function" href="Model_2include_8php.html#a5afab85a7aaf19395f9a0e86cae76928">Error</a>($nestingStr . _(<span class="stringliteral">&#39;Rule&#39;</span>) . <span class="stringliteral">&quot; $ruleNumber: &quot;</span> . _(<span class="stringliteral">&#39;Error loading, rule loaded partially&#39;</span>));</div>
<div class="line"><span class="lineno">   84</span>                    <a class="code hl_function" href="Model_2include_8php.html#aacb56ea458e6602b98977b24fbbb4ebe">ctlr_syslog</a>(LOG_NOTICE, __FILE__, __FUNCTION__, __LINE__, $nestingStr . <span class="stringliteral">&quot;Rule $ruleNumber: Error loading, rule loaded partially&quot;</span>);</div>
<div class="line"><span class="lineno">   85</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">   86</span>                    <a class="code hl_function" href="Model_2include_8php.html#a5afab85a7aaf19395f9a0e86cae76928">Error</a>($nestingStr . _(<span class="stringliteral">&#39;Rule&#39;</span>) . <span class="stringliteral">&quot; $ruleNumber: &quot;</span> . _(<span class="stringliteral">&#39;Error loading, rule load forced&#39;</span>));</div>
<div class="line"><span class="lineno">   87</span>                    <a class="code hl_function" href="Model_2include_8php.html#aacb56ea458e6602b98977b24fbbb4ebe">ctlr_syslog</a>(LOG_NOTICE, __FILE__, __FUNCTION__, __LINE__, $nestingStr . <span class="stringliteral">&quot;Rule $ruleNumber: Error loading, rule load forced&quot;</span>);</div>
<div class="line"><span class="lineno">   88</span>                }</div>
<div class="line"><span class="lineno">   89</span>                <a class="code hl_variable" href="ctlr_8php.html#a80b96347dc2ad0d4e3748dc87db72731">$retval</a>= FALSE;</div>
<div class="line"><span class="lineno">   90</span>            }</div>
<div class="line"><span class="lineno">   91</span>            $this-&gt;rules[]= $ruleObj;</div>
<div class="line"><span class="lineno">   92</span>            $ruleNumber++;</div>
<div class="line"><span class="lineno">   93</span>        }</div>
<div class="line"><span class="lineno">   94</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="ctlr_8php.html#a80b96347dc2ad0d4e3748dc87db72731">$retval</a>;</div>
<div class="line"><span class="lineno">   95</span>    }</div>
<div class="ttc" id="aModel_2include_8php_html_a5afab85a7aaf19395f9a0e86cae76928"><div class="ttname"><a href="Model_2include_8php.html#a5afab85a7aaf19395f9a0e86cae76928">Error</a></div><div class="ttdeci">Error($msg)</div><div class="ttdoc">Sets or updates $Error with the given message.</div><div class="ttdef"><b>Definition:</b> <a href="Model_2include_8php_source.html#l00131">include.php:131</a></div></div>
<div class="ttc" id="aModel_2include_8php_html_aacb56ea458e6602b98977b24fbbb4ebe"><div class="ttname"><a href="Model_2include_8php.html#aacb56ea458e6602b98977b24fbbb4ebe">ctlr_syslog</a></div><div class="ttdeci">ctlr_syslog($prio, $file, $func, $line, $msg)</div><div class="ttdoc">Wrapper for controller error logging via syslog.</div><div class="ttdef"><b>Definition:</b> <a href="Model_2include_8php_source.html#l00194">include.php:194</a></div></div>
<div class="ttc" id="aconf_8write_8php_html_ac60027de12260e75a070f5a7618fd632"><div class="ttname"><a href="conf_8write_8php.html#ac60027de12260e75a070f5a7618fd632">$force</a></div><div class="ttdeci">$force</div><div class="ttdef"><b>Definition:</b> <a href="conf_8write_8php_source.html#l00041">conf.write.php:41</a></div></div>
<div class="ttc" id="actlr_8php_html_a80b96347dc2ad0d4e3748dc87db72731"><div class="ttname"><a href="ctlr_8php.html#a80b96347dc2ad0d4e3748dc87db72731">$retval</a></div><div class="ttdeci">if( $ArgV[0]==='-n') if($ArgV[0]==='-t') $retval</div><div class="ttdef"><b>Definition:</b> <a href="ctlr_8php_source.html#l00072">ctlr.php:72</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="conf_8write_8php_source.html#l00041">$force</a>, <a class="el" href="ctlr_8php_source.html#l00072">$retval</a>, <a class="el" href="Model_2include_8php_source.html#l00194">ctlr_syslog()</a>, and <a class="el" href="Model_2include_8php_source.html#l00131">Error()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classModel_1_1RuleSet_ab0b389ad9ebc166cb794517ae2d32f77_cgraph.png" border="0" usemap="#aclassModel_1_1RuleSet_ab0b389ad9ebc166cb794517ae2d32f77_cgraph" alt=""/></div>
<map name="aclassModel_1_1RuleSet_ab0b389ad9ebc166cb794517ae2d32f77_cgraph" id="aclassModel_1_1RuleSet_ab0b389ad9ebc166cb794517ae2d32f77_cgraph">
<area shape="rect" title="Loads the rule definitions given in an array." alt="" coords="5,31,56,56"/>
<area shape="rect" href="Model_2include_8php.html#aacb56ea458e6602b98977b24fbbb4ebe" title="Wrapper for controller error logging via syslog." alt="" coords="104,5,196,31"/>
<area shape="rect" href="Model_2include_8php.html#a5afab85a7aaf19395f9a0e86cae76928" title="Sets or updates $Error with the given message." alt="" coords="123,55,177,80"/>
</map>
</div>

</div>
</div>
<a id="a993caf27d61ba671b700b966eb23e926" name="a993caf27d61ba671b700b966eb23e926"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a993caf27d61ba671b700b966eb23e926">&#9670;&#160;</a></span>parse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parse </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$text</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$force</em> = <code>FALSE</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Parses the given rule string. </p>
<p>These are the steps: </p><ul>
<li>First delete any existing rules </li>
<li>Sort out inline comments and new lines </li>
<li>Divide the given string into lines, which are to be parsed by rule objects </li>
<li>Determine the type of rule on each line </li>
<li>Insert any accumulated comments or blank lines </li>
<li>Collect inline anchor rules which span multiple lines </li>
<li>Finally create a rule object of the type determined above and pass the line to be parsed to that object</li>
</ul>
<p>We validate the ruleset after all those steps are completed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$text</td><td>Rule set in string format to parse. </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$force</td><td>Used to override validation or other types of errors, hence forces loading of rules. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool Validation result. </dd></dl>
<dl class="section attention"><dt>Attention</dt><dd>Do not append accumulated blank lines to the end</dd></dl>

<p class="definition">Definition at line <a class="el" href="Model_2lib_2RuleSet_8php_source.html#l00123">123</a> of file <a class="el" href="Model_2lib_2RuleSet_8php_source.html">RuleSet.php</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  124</span>    {</div>
<div class="line"><span class="lineno">  125</span>        $this-&gt;deleteRules();</div>
<div class="line"><span class="lineno">  126</span>        $ruleLines= array();</div>
<div class="line"><span class="lineno">  127</span> </div>
<div class="line"><span class="lineno">  128</span>        $text= preg_replace(<span class="stringliteral">&quot;/\n#/&quot;</span>, <span class="stringliteral">&quot;\n# &quot;</span>, $text);</div>
<div class="line"><span class="lineno">  129</span>        $text= str_replace(<span class="stringliteral">&quot;\\\n&quot;</span>, <span class="stringliteral">&#39;&#39;</span>, $text);</div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span>        $ruleLines= explode(<span class="stringliteral">&quot;\n&quot;</span>, $text);</div>
<div class="line"><span class="lineno">  132</span> </div>
<div class="line"><span class="lineno">  133</span>        $blank= <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><span class="lineno">  134</span> </div>
<div class="line"><span class="lineno">  135</span>        <span class="keywordflow">for</span> ($index= 0; $index &lt; count($ruleLines); $index++) {</div>
<div class="line"><span class="lineno">  136</span>            $str= $ruleLines[$index];</div>
<div class="line"><span class="lineno">  137</span>            $words= preg_split(<span class="stringliteral">&#39;/[\s,\t]+/&#39;</span>, trim($str), -1);</div>
<div class="line"><span class="lineno">  138</span>            </div>
<div class="line"><span class="lineno">  139</span>            $type= $words[0];</div>
<div class="line"><span class="lineno">  140</span>            <span class="comment">// Do not search in comment lines</span></div>
<div class="line"><span class="lineno">  141</span>            <span class="keywordflow">if</span> ($type !== <span class="stringliteral">&#39;&#39;</span> &amp;&amp; $type !== <span class="charliteral">&#39;#&#39;</span>) {</div>
<div class="line"><span class="lineno">  142</span>                <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/\s+(scrub|af-to|nat-to|binat-to|divert-to|rdr-to|route-to|reply-to|dup-to|divert-packet|state-defaults)\s+/&#39;</span>, $str, $match)) {</div>
<div class="line"><span class="lineno">  143</span>                    $type= $match[1];</div>
<div class="line"><span class="lineno">  144</span>                } elseif (preg_match(<span class="stringliteral">&#39;/\bset\s+(timeout|limit)\s+/&#39;</span>, $str, $match)) {</div>
<div class="line"><span class="lineno">  145</span>                    $type= $match[1];</div>
<div class="line"><span class="lineno">  146</span>                }</div>
<div class="line"><span class="lineno">  147</span>            }</div>
<div class="line"><span class="lineno">  148</span> </div>
<div class="line"><span class="lineno">  149</span>            <span class="comment">// Add any accumulated comment or blank lines if a non-comment/blank rule is next</span></div>
<div class="line"><span class="lineno">  150</span>            <span class="keywordflow">if</span> ($type !== <span class="stringliteral">&#39;&#39;</span> &amp;&amp; $type !== <span class="charliteral">&#39;#&#39;</span>) {</div>
<div class="line"><span class="lineno">  151</span>                <span class="keywordflow">if</span> (isset($comment)) {</div>
<div class="line"><span class="lineno">  152</span>                    $this-&gt;rules[]= <span class="keyword">new</span> Comment($comment);</div>
<div class="line"><span class="lineno">  153</span>                    unset($comment);</div>
<div class="line"><span class="lineno">  154</span>                }</div>
<div class="line"><span class="lineno">  155</span>                <span class="keywordflow">if</span> ($blank != <span class="stringliteral">&#39;&#39;</span>) {</div>
<div class="line"><span class="lineno">  156</span>                    $this-&gt;rules[]= <span class="keyword">new</span> Blank($blank);</div>
<div class="line"><span class="lineno">  157</span>                    $blank= <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><span class="lineno">  158</span>                }</div>
<div class="line"><span class="lineno">  159</span>            }</div>
<div class="line"><span class="lineno">  160</span> </div>
<div class="line"><span class="lineno">  161</span>            <span class="keywordflow">if</span> ($type === <span class="stringliteral">&#39;anchor&#39;</span> &amp;&amp; preg_match(<span class="stringliteral">&#39;/^.*{\s*$/&#39;</span>, $str)) {</div>
<div class="line"><span class="lineno">  162</span>                $this-&gt;<a class="code hl_function" href="classModel_1_1RuleSet.html#a5b90753ebc701d41dbd2e3abb2e64cdb">parseInlineRules</a>($ruleLines, $str, $index, <a class="code hl_variable" href="conf_8write_8php.html#ac60027de12260e75a070f5a7618fd632">$force</a>);</div>
<div class="line"><span class="lineno">  163</span>            }</div>
<div class="line"><span class="lineno">  164</span> </div>
<div class="line"><span class="lineno">  165</span>            <span class="keywordflow">switch</span> ($type) {</div>
<div class="line"><span class="lineno">  166</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;&#39;</span>:</div>
<div class="line"><span class="lineno">  167</span>                    <span class="keywordflow">if</span> (isset($comment)) {</div>
<div class="line"><span class="lineno">  168</span>                        $this-&gt;rules[]= <span class="keyword">new</span> Comment($comment);</div>
<div class="line"><span class="lineno">  169</span>                        unset($comment);</div>
<div class="line"><span class="lineno">  170</span>                    }</div>
<div class="line"><span class="lineno">  171</span>                    $blank.= <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><span class="lineno">  172</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  173</span>                <span class="keywordflow">case</span> <span class="charliteral">&#39;#&#39;</span>:</div>
<div class="line"><span class="lineno">  174</span>                    <span class="keywordflow">if</span> ($blank != <span class="stringliteral">&#39;&#39;</span>) {</div>
<div class="line"><span class="lineno">  175</span>                        $this-&gt;rules[]= <span class="keyword">new</span> Blank($blank);</div>
<div class="line"><span class="lineno">  176</span>                        $blank= <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><span class="lineno">  177</span>                    }</div>
<div class="line"><span class="lineno">  178</span>                    <span class="keywordflow">if</span> (!isset($comment)) {</div>
<div class="line"><span class="lineno">  179</span>                        $comment= trim(substr($str, 1));</div>
<div class="line"><span class="lineno">  180</span>                    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  181</span>                        $comment.= <span class="stringliteral">&quot;\n&quot;</span> . trim(substr($str, 1));</div>
<div class="line"><span class="lineno">  182</span>                    }</div>
<div class="line"><span class="lineno">  183</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  184</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;include&#39;</span>:</div>
<div class="line"><span class="lineno">  185</span>                    $this-&gt;rules[]= <span class="keyword">new</span> _Include($str);</div>
<div class="line"><span class="lineno">  186</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  187</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;anchor&#39;</span>:</div>
<div class="line"><span class="lineno">  188</span>                    $this-&gt;rules[]= <span class="keyword">new</span> Anchor($str);</div>
<div class="line"><span class="lineno">  189</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  190</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;pass&#39;</span>:</div>
<div class="line"><span class="lineno">  191</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;block&#39;</span>:</div>
<div class="line"><span class="lineno">  192</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;match&#39;</span>:</div>
<div class="line"><span class="lineno">  193</span>                    $this-&gt;rules[]= <span class="keyword">new</span> Filter($str);</div>
<div class="line"><span class="lineno">  194</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  195</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;antispoof&#39;</span>:</div>
<div class="line"><span class="lineno">  196</span>                    $this-&gt;rules[]= <span class="keyword">new</span> Antispoof($str);</div>
<div class="line"><span class="lineno">  197</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  198</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;af-to&#39;</span>:</div>
<div class="line"><span class="lineno">  199</span>                    $this-&gt;rules[]= <span class="keyword">new</span> AfTo($str);</div>
<div class="line"><span class="lineno">  200</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  201</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;nat-to&#39;</span>:</div>
<div class="line"><span class="lineno">  202</span>                    $this-&gt;rules[]= <span class="keyword">new</span> NatTo($str);</div>
<div class="line"><span class="lineno">  203</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  204</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;binat-to&#39;</span>:</div>
<div class="line"><span class="lineno">  205</span>                    $this-&gt;rules[]= <span class="keyword">new</span> BinatTo($str);</div>
<div class="line"><span class="lineno">  206</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  207</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;divert-to&#39;</span>:</div>
<div class="line"><span class="lineno">  208</span>                    $this-&gt;rules[]= <span class="keyword">new</span> DivertTo($str);</div>
<div class="line"><span class="lineno">  209</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  210</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;divert-packet&#39;</span>:</div>
<div class="line"><span class="lineno">  211</span>                    $this-&gt;rules[]= <span class="keyword">new</span> DivertPacket($str);</div>
<div class="line"><span class="lineno">  212</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  213</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;rdr-to&#39;</span>:</div>
<div class="line"><span class="lineno">  214</span>                    $this-&gt;rules[]= <span class="keyword">new</span> RdrTo($str);</div>
<div class="line"><span class="lineno">  215</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  216</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;route-to&#39;</span>:</div>
<div class="line"><span class="lineno">  217</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;reply-to&#39;</span>:</div>
<div class="line"><span class="lineno">  218</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;dup-to&#39;</span>:</div>
<div class="line"><span class="lineno">  219</span>                    $this-&gt;rules[]= <span class="keyword">new</span> Route($str);</div>
<div class="line"><span class="lineno">  220</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  221</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;timeout&#39;</span>:</div>
<div class="line"><span class="lineno">  222</span>                    $this-&gt;rules[]= <span class="keyword">new</span> Timeout($str);</div>
<div class="line"><span class="lineno">  223</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  224</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;state-defaults&#39;</span>:</div>
<div class="line"><span class="lineno">  225</span>                    $this-&gt;rules[]= <span class="keyword">new</span> State($str);</div>
<div class="line"><span class="lineno">  226</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  227</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;set&#39;</span>:</div>
<div class="line"><span class="lineno">  228</span>                    $this-&gt;rules[]= <span class="keyword">new</span> Option($str);</div>
<div class="line"><span class="lineno">  229</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  230</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;limit&#39;</span>:</div>
<div class="line"><span class="lineno">  231</span>                    $this-&gt;rules[]= <span class="keyword">new</span> Limit($str);</div>
<div class="line"><span class="lineno">  232</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  233</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;scrub&#39;</span>:</div>
<div class="line"><span class="lineno">  234</span>                    $this-&gt;rules[]= <span class="keyword">new</span> Scrub($str);</div>
<div class="line"><span class="lineno">  235</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  236</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;table&#39;</span>:</div>
<div class="line"><span class="lineno">  237</span>                    $this-&gt;rules[]= <span class="keyword">new</span> Table($str);</div>
<div class="line"><span class="lineno">  238</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  239</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;queue&#39;</span>:</div>
<div class="line"><span class="lineno">  240</span>                    $this-&gt;rules[]= <span class="keyword">new</span> Queue($str);</div>
<div class="line"><span class="lineno">  241</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  242</span>                <span class="keywordflow">case</span> <span class="stringliteral">&#39;load&#39;</span>:</div>
<div class="line"><span class="lineno">  243</span>                    $this-&gt;rules[]= <span class="keyword">new</span> LoadAnchor($str);</div>
<div class="line"><span class="lineno">  244</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  245</span>                <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  246</span>                    $this-&gt;rules[]= <span class="keyword">new</span> Macro($str);</div>
<div class="line"><span class="lineno">  247</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  248</span>            }</div>
<div class="line"><span class="lineno">  249</span>        }</div>
<div class="line"><span class="lineno">  250</span>        </div>
<div class="line"><span class="lineno">  251</span>        <span class="comment">// Necessary if there is no non-comment rule at the end of ruleset</span></div>
<div class="line"><span class="lineno">  252</span>        <span class="keywordflow">if</span> (isset($comment)) {</div>
<div class="line"><span class="lineno">  253</span>            $this-&gt;rules[]= <span class="keyword">new</span> Comment($comment);</div>
<div class="line"><span class="lineno">  254</span>        }</div>
<div class="line"><span class="lineno">  256</span>        </div>
<div class="line"><span class="lineno">  257</span>        <span class="keywordflow">return</span> $this-&gt;<a class="code hl_function" href="classModel_1_1RuleSet.html#a6177d48190953277c146592478f02e24">validate</a>(<a class="code hl_variable" href="conf_8write_8php.html#ac60027de12260e75a070f5a7618fd632">$force</a>);</div>
<div class="line"><span class="lineno">  258</span>    }</div>
<div class="ttc" id="aclassModel_1_1RuleSet_html_a5b90753ebc701d41dbd2e3abb2e64cdb"><div class="ttname"><a href="classModel_1_1RuleSet.html#a5b90753ebc701d41dbd2e3abb2e64cdb">Model\RuleSet\parseInlineRules</a></div><div class="ttdeci">parseInlineRules($ruleLines, &amp;$str, &amp;$index, $force=FALSE)</div><div class="ttdoc">Collects inline anchor rules spanning multiple lines.</div><div class="ttdef"><b>Definition:</b> <a href="Model_2lib_2RuleSet_8php_source.html#l00312">RuleSet.php:312</a></div></div>
<div class="ttc" id="aclassModel_1_1RuleSet_html_a6177d48190953277c146592478f02e24"><div class="ttname"><a href="classModel_1_1RuleSet.html#a6177d48190953277c146592478f02e24">Model\RuleSet\validate</a></div><div class="ttdeci">validate($force=FALSE)</div><div class="ttdoc">Validates the ruleset.</div><div class="ttdef"><b>Definition:</b> <a href="Model_2lib_2RuleSet_8php_source.html#l00270">RuleSet.php:270</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="conf_8write_8php_source.html#l00041">$force</a>.</p>

</div>
</div>
<a id="a5b90753ebc701d41dbd2e3abb2e64cdb" name="a5b90753ebc701d41dbd2e3abb2e64cdb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5b90753ebc701d41dbd2e3abb2e64cdb">&#9670;&#160;</a></span>parseInlineRules()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">parseInlineRules </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$ruleLines</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$force</em> = <code>FALSE</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Collects inline anchor rules spanning multiple lines. </p>
<p>Inline rule starts with an opening brace at the end of the anchor line and ends with a closing brace at the beginning of the last line, possibly followed by an inline comment.</p>
<div class="fragment"><div class="line">anchor <span class="stringliteral">&quot;external&quot;</span> on egress {</div>
<div class="line">    block</div>
<div class="line">    anchor out {</div>
<div class="line">        pass proto tcp from any to port { 25, 80, 443 }</div>
<div class="line">    }</div>
<div class="line">    pass in proto tcp to any port 22</div>
<div class="line">} # Inline comment</div>
</div><!-- fragment --><p>Since inline rules span multiple lines, we combine those lines and append them at the end of the anchor rule after the 'inline' keyword. This process advances the line index to the line following the last inline rule.</p>
<p>Nested anchor rules are allowed in inline rules. We limit the number of nesting by $MaxAnchorNesting. This limit can be overridden by the $force parameter. Otherwise, the method stops collecting and combining inline rules after $MaxAnchorNesting number of nesting is reached.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$ruleLines</td><td>Rule strings in array format. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$str</td><td>Current anchor rule in string format. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$index</td><td>Index pointing at the current line. </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$force</td><td>Forces collection of inline rules even after nesting limit is reached. </td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000016">Todo:</a></b></dt><dd>Use recursion instead? </dd></dl>

<p class="definition">Definition at line <a class="el" href="Model_2lib_2RuleSet_8php_source.html#l00312">312</a> of file <a class="el" href="Model_2lib_2RuleSet_8php_source.html">RuleSet.php</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  313</span>    {</div>
<div class="line"><span class="lineno">  314</span>        global <a class="code hl_variable" href="lib_2setup_8php.html#a3b1a8ebf5794114e1bcd16b4bbc80dbb">$MaxAnchorNesting</a>;</div>
<div class="line"><span class="lineno">  315</span> </div>
<div class="line"><span class="lineno">  316</span>        <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^(.*){\s*$/&#39;</span>, $str, $match)) {</div>
<div class="line"><span class="lineno">  317</span>            $str= $match[1] . <span class="stringliteral">&#39; inline &#39;</span>;</div>
<div class="line"><span class="lineno">  318</span> </div>
<div class="line"><span class="lineno">  319</span>            $nesting= 1;</div>
<div class="line"><span class="lineno">  320</span>            $index++;</div>
<div class="line"><span class="lineno">  321</span>            <span class="keywordflow">while</span> ($index &lt; count($ruleLines)) {</div>
<div class="line"><span class="lineno">  322</span>                $line= $ruleLines[$index];</div>
<div class="line"><span class="lineno">  323</span> </div>
<div class="line"><span class="lineno">  324</span>                <span class="comment">// anchor-close = &quot;}&quot;, but there may be a comment after it, hence match</span></div>
<div class="line"><span class="lineno">  325</span>                <span class="keywordflow">if</span> (!preg_match(<span class="stringliteral">&#39;/^\s*}(.*)$/&#39;</span>, $line, $match)) {</div>
<div class="line"><span class="lineno">  326</span>                    $str.= <span class="stringliteral">&quot;$line\n&quot;</span>;</div>
<div class="line"><span class="lineno">  328</span>                    <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^.*{\s*$/&#39;</span>, $line)) {</div>
<div class="line"><span class="lineno">  329</span>                        <span class="comment">// Do not allow more than $MaxAnchorNesting count of nested inline rules</span></div>
<div class="line"><span class="lineno">  330</span>                        <span class="keywordflow">if</span> (++$nesting &gt; <a class="code hl_variable" href="lib_2setup_8php.html#a3b1a8ebf5794114e1bcd16b4bbc80dbb">$MaxAnchorNesting</a>) {</div>
<div class="line"><span class="lineno">  331</span>                            <a class="code hl_function" href="Model_2include_8php.html#a5afab85a7aaf19395f9a0e86cae76928">Error</a>(_(<span class="stringliteral">&#39;Parse Error&#39;</span>) . <span class="stringliteral">&#39;: &#39;</span> . _(<span class="stringliteral">&#39;Reached max nesting for inline anchors&#39;</span>) . <span class="stringliteral">&#39;: &lt;pre&gt;&#39;</span> . htmlentities(print_r($line, TRUE)) . <span class="stringliteral">&#39;&lt;/pre&gt;&#39;</span>);</div>
<div class="line"><span class="lineno">  332</span>                            <a class="code hl_function" href="Model_2include_8php.html#aacb56ea458e6602b98977b24fbbb4ebe">ctlr_syslog</a>(LOG_ERR, __FILE__, __FUNCTION__, __LINE__, <span class="stringliteral">&quot;Parse Error: Reached max nesting for inline anchors: $line&quot;</span>);</div>
<div class="line"><span class="lineno">  333</span>                            <span class="keywordflow">if</span> (!<a class="code hl_variable" href="conf_8write_8php.html#ac60027de12260e75a070f5a7618fd632">$force</a>) {</div>
<div class="line"><span class="lineno">  334</span>                                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  335</span>                            }</div>
<div class="line"><span class="lineno">  336</span>                        }</div>
<div class="line"><span class="lineno">  337</span>                    }</div>
<div class="line"><span class="lineno">  338</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  339</span>                    <span class="keywordflow">if</span> (--$nesting == 0) {</div>
<div class="line"><span class="lineno">  340</span>                        <span class="comment">// Discard the last anchor-close, keep the trailing text</span></div>
<div class="line"><span class="lineno">  341</span>                        $str.= $match[1] . <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><span class="lineno">  342</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  343</span>                    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  344</span>                        <span class="comment">// Don&#39;t discard the anchor-close of nested anchors</span></div>
<div class="line"><span class="lineno">  345</span>                        $str.= <span class="stringliteral">&quot;$line\n&quot;</span>;</div>
<div class="line"><span class="lineno">  346</span>                    }</div>
<div class="line"><span class="lineno">  347</span>                }</div>
<div class="line"><span class="lineno">  348</span>                $index++;</div>
<div class="line"><span class="lineno">  349</span>            }</div>
<div class="line"><span class="lineno">  350</span>        }</div>
<div class="line"><span class="lineno">  351</span>    }</div>
<div class="ttc" id="alib_2setup_8php_html_a3b1a8ebf5794114e1bcd16b4bbc80dbb"><div class="ttname"><a href="lib_2setup_8php.html#a3b1a8ebf5794114e1bcd16b4bbc80dbb">$MaxAnchorNesting</a></div><div class="ttdeci">$MaxAnchorNesting</div><div class="ttdoc">Max inline anchors allowed.</div><div class="ttdef"><b>Definition:</b> <a href="lib_2setup_8php_source.html#l00032">setup.php:32</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="conf_8write_8php_source.html#l00041">$force</a>, <a class="el" href="lib_2setup_8php_source.html#l00032">$MaxAnchorNesting</a>, <a class="el" href="Model_2include_8php_source.html#l00194">ctlr_syslog()</a>, and <a class="el" href="Model_2include_8php_source.html#l00131">Error()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classModel_1_1RuleSet_a5b90753ebc701d41dbd2e3abb2e64cdb_cgraph.png" border="0" usemap="#aclassModel_1_1RuleSet_a5b90753ebc701d41dbd2e3abb2e64cdb_cgraph" alt=""/></div>
<map name="aclassModel_1_1RuleSet_a5b90753ebc701d41dbd2e3abb2e64cdb_cgraph" id="aclassModel_1_1RuleSet_a5b90753ebc701d41dbd2e3abb2e64cdb_cgraph">
<area shape="rect" title="Collects inline anchor rules spanning multiple lines." alt="" coords="5,31,136,56"/>
<area shape="rect" href="Model_2include_8php.html#aacb56ea458e6602b98977b24fbbb4ebe" title="Wrapper for controller error logging via syslog." alt="" coords="184,5,276,31"/>
<area shape="rect" href="Model_2include_8php.html#a5afab85a7aaf19395f9a0e86cae76928" title="Sets or updates $Error with the given message." alt="" coords="203,55,257,80"/>
</map>
</div>

</div>
</div>
<a id="a6177d48190953277c146592478f02e24" name="a6177d48190953277c146592478f02e24"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6177d48190953277c146592478f02e24">&#9670;&#160;</a></span>validate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">validate </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$force</em> = <code>FALSE</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Validates the ruleset. </p>
<p>Since encoding and decoding the rules array produce an array with the elements we need, we reload the already loaded ruleset using json encode and decode functions. The load method validates the rules in the ruleset.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">bool</td><td class="paramname">$force</td><td>Used to override validation or other types of errors, hence forces loading of rules. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool Validation result. </dd></dl>

<p class="definition">Definition at line <a class="el" href="Model_2lib_2RuleSet_8php_source.html#l00270">270</a> of file <a class="el" href="Model_2lib_2RuleSet_8php_source.html">RuleSet.php</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  271</span>    {</div>
<div class="line"><span class="lineno">  272</span>        <span class="comment">// Reload for validation</span></div>
<div class="line"><span class="lineno">  273</span>        $rulesArray= json_decode(json_encode($this-&gt;rules), TRUE);</div>
<div class="line"><span class="lineno">  274</span>        <span class="keywordflow">if</span> (!$this-&gt;<a class="code hl_function" href="tools_8inc.html#a585c262d16bad21a05af8804df8372b2">load</a>($rulesArray, <a class="code hl_variable" href="conf_8write_8php.html#ac60027de12260e75a070f5a7618fd632">$force</a>)) {</div>
<div class="line"><span class="lineno">  275</span>            <a class="code hl_function" href="Model_2include_8php.html#a5afab85a7aaf19395f9a0e86cae76928">Error</a>(_(<span class="stringliteral">&#39;Load Error&#39;</span>) . <span class="stringliteral">&#39;: &#39;</span> . _(<span class="stringliteral">&#39;Ruleset contains errors&#39;</span>));</div>
<div class="line"><span class="lineno">  276</span>            <a class="code hl_function" href="Model_2include_8php.html#aacb56ea458e6602b98977b24fbbb4ebe">ctlr_syslog</a>(LOG_ERR, __FILE__, __FUNCTION__, __LINE__, <span class="stringliteral">&#39;Load Error: Ruleset contains errors&#39;</span>);</div>
<div class="line"><span class="lineno">  277</span>            <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><span class="lineno">  278</span>        }</div>
<div class="line"><span class="lineno">  279</span>        <span class="keywordflow">return</span> TRUE;</div>
<div class="line"><span class="lineno">  280</span>    }</div>
<div class="ttc" id="atools_8inc_html_a585c262d16bad21a05af8804df8372b2"><div class="ttname"><a href="tools_8inc.html#a585c262d16bad21a05af8804df8372b2">load</a></div><div class="ttdeci">load($filename)</div><div class="ttdef"><b>Definition:</b> <a href="tools_8inc_source.html#l00088">tools.inc:88</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="conf_8write_8php_source.html#l00041">$force</a>, <a class="el" href="Model_2include_8php_source.html#l00194">ctlr_syslog()</a>, <a class="el" href="Model_2include_8php_source.html#l00131">Error()</a>, and <a class="el" href="tools_8inc_source.html#l00088">load()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classModel_1_1RuleSet_a6177d48190953277c146592478f02e24_cgraph.png" border="0" usemap="#aclassModel_1_1RuleSet_a6177d48190953277c146592478f02e24_cgraph" alt=""/></div>
<map name="aclassModel_1_1RuleSet_a6177d48190953277c146592478f02e24_cgraph" id="aclassModel_1_1RuleSet_a6177d48190953277c146592478f02e24_cgraph">
<area shape="rect" title="Validates the ruleset." alt="" coords="5,55,80,80"/>
<area shape="rect" href="Model_2include_8php.html#aacb56ea458e6602b98977b24fbbb4ebe" title="Wrapper for controller error logging via syslog." alt="" coords="128,5,220,31"/>
<area shape="rect" href="Model_2include_8php.html#a5afab85a7aaf19395f9a0e86cae76928" title="Sets or updates $Error with the given message." alt="" coords="147,55,201,80"/>
<area shape="rect" href="tools_8inc.html#a585c262d16bad21a05af8804df8372b2" title=" " alt="" coords="149,104,199,129"/>
<area shape="rect" href="tools_8inc.html#a5ba476111ad2c0046eb66f85f13d4919" title=" " alt="" coords="268,104,379,129"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Field Documentation</h2>
<a id="a811d22ac55b4592f7f2a202529629419" name="a811d22ac55b4592f7f2a202529629419"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a811d22ac55b4592f7f2a202529629419">&#9670;&#160;</a></span>$rules</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">$rules = array()</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="Model_2lib_2RuleSet_8php_source.html#l00046">46</a> of file <a class="el" href="Model_2lib_2RuleSet_8php_source.html">RuleSet.php</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>src/Model/lib/<a class="el" href="Model_2lib_2RuleSet_8php_source.html">RuleSet.php</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceModel.html">Model</a></li><li class="navelem"><a class="el" href="classModel_1_1RuleSet.html">RuleSet</a></li>
    <li class="footer">Generated on Sun Apr 30 2023 00:52:50 for PF Firewall by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
